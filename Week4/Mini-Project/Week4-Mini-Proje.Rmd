---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

T.C. Çevre Şehircilik ve İklim Değişikliği bakanlığının ülke genelinde yaptığı hava kalitesi
ölçümleri [https://sim.csb.gov.tr/Services/AirQuality](https://sim.csb.gov.tr/Services/AirQuality) adresinde bulunan web uygulamasında istasyon bazında görsellenebilmektedir. 

Ham veriler ise [https://sim.csb.gov.tr/STN/STN_Report/StationDataDownloadNew](https://sim.csb.gov.tr/STN/STN_Report/StationDataDownloadNew) adresinden *Excel* formatında indirlebilmektedir. 

## Egzersiz 1 - Veri ithali

**Doğduğunuz şehre** ait olan **saatlik** hava kalitesi parametrelerini *Excel* formatında **doğduğunuz ay** için indirin. Tam bir aylık veri indirmeniz gerekmektedir.

Örnek :

- Mart ayında doğduysanız Mart 2023 verisi (Çünkü Mart 2024 bitmedi)
- Aralık ayında doğduysanız Aralık 2023 verisi
- Şubat ayında doğduysanız Şubat 2024 verisi

Yaratacağınız data.frame nesnesinin sütun isimleri Excel'de bulunan değişken sütun isimlerini içermelidir. *havaK* nesnesinin ilk 10 satırının raporda gözükmesini sağlayın.

```{r}
# Excel dosyasındaki ham verileri data.frame formatında R'a ithal edin
library(readxl)
library(dplyr)

# hocam şöyle bir problemle karşılaştım. önce 1 numaralı satırı ekledikten sonra excel verisinin yanına  na = "-" eklersem kod çalışıyor ama önce na yı eklersem çalışmıyor ve çözemedim
#havaK <- readxl::read_excel("C:/Users/omerli/Desktop/rödev/manisa-soma-veridetaylari.xlsx", na = "-")

# data frame çevir ve toplu bir numeric yap
havaK <- as.data.frame(readxl::read_excel("manisa-soma-veridetaylari.xlsx"))
```


## Egzersiz 2 - Veri Kalite Kontrolü

### Zaman sütunu
Zaman değerlerini içeren sütunun isminin **Time** olmasını sağlayın
```{r}
# zaman sütununun adını Time olarak değiştir
colnames(havaK)[colnames(havaK) == "Tarih"] <- "Time"
```


*havaK$Time* adlı değişkendeki bütün verilerin **POSIXct** tipinde olmasını sağlayın. 

```{r}

# Time sütununu POSIXct türüne dönüştür
havaK$Time <- as.POSIXct(havaK$Time, format = "%Y-%m-%d")
```

*Time* sütunu dışındaki bütün sütunların tipinin **numeric** olmasını sağlayın. *havaK* nesnesinin ilk 10 satırının raporda gözükmesini sağlayın.

```{r}
havaK[, -1] <- lapply(havaK[, -1], function(x) gsub(",", ".", x))
havaK[, -1] <-(lapply(havaK[, -1], as.numeric))

havaK$Time <- as.POSIXct(havaK$Time, format = "%Y-%m-%d")
# İlk 10 satırı göster
print(head(havaK, 10))
```

## Egzersiz 3 - Veri Görselleme
*dygraphs* paketini kullanarak veri setinizde bulunan iki farklı parametreyi aynı grafik üzerinde iki değişik aks kullanarak (bkz örnek) çizin.

![](graphic_example.png "İki akslı grafik örneği")


```{r}
library(dygraphs)

# Veri setini düzenle
havaK <- havaK[-1, ]  # İlk satır başlık olduğu için kaldır

# Sütun adlarını güncelle
names(havaK) <- c("Time", "PM10", "PM2.5", "SO2", "NO2", "NOX", "NO", "O3")

# Karakter sütunları sayısal değerlere dönüştür
havaK[, -1] <- lapply(havaK[, -1], function(x) as.numeric(gsub(",", ".", x)))

# PM10 ve PM2.5 sütunlarını seç
havaK_grafik <- havaK[, c("Time", "PM10", "PM2.5")]

# Dygraph çizimi
graph <- dygraph(havaK_grafik, main = "Manisa - Soma Hava Kalitesi") %>%
  dySeries("PM10", label = "PM10 (\u03bcg/m3)", axis = "y") %>%
  dyOptions(drawPoints = TRUE, pointSize = 10) %>%
  dyAxis("y", label = "PM10 (\u03bcg/m3)", valueRange = c(0, max(havaK_grafik$PM10) * 1.1)) %>%
  dySeries("PM2.5", label = "PM 2.5 (\u03bcg/m3)", axis = "y2") %>%
  dyAxis("y2", label = "PM 2.5 (\u03bcg/m3)", independentTicks = TRUE, valueRange = c(0, max(havaK_grafik$PM2.5) * 1.1)) %>%
  dyOptions(colors = RColorBrewer::brewer.pal(2, "Set1"))

# Grafiği göster
graph



```

